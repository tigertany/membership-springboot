<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tany.membership.dao.SysPermissionMapper">

    <select id="selectPermissionByRole" resultType="com.tany.membership.vo.PermissionWithChecked" parameterType="java.lang.Long">
      SELECT case when D.permission_id is null then false else true end checked,
        A.id,
        A.name,
        A.type,
        A.parent_id,
        A.path,
        A.url,
        A.words,
        A.icon,
        A.sort,
        A.status,
        D.*
      FROM sys_permission A
      LEFT JOIN (
      SELECT
          B.permission_id,
          C.id role_id,
          C.code role_code,
          C.name role_name
      FROM
          sys_permission_relation B
          INNER JOIN sys_role C ON B.share_id = C.id
          AND B.type = 1
          AND C.deleted = 0
      WHERE
          C.id = #{roleId}
      ) D ON A.id = D.permission_id
    </select>

    <select id="selectPermissionByUser" resultType="com.tany.membership.entity.SysPermission" parameterType="java.lang.Long">
      SELECT A.* FROM sys_permission A
	  INNER JOIN (
	    SELECT
		B.permission_id,
		C.id role_id,
		C.code role_code,
		C.name role_name,
		G.username,
		G.account
	    FROM
		sys_permission_relation B
		INNER JOIN sys_role C ON B.share_id = C.id
		AND B.type = 1
		AND C.deleted = 0
		INNER JOIN sys_user_role F ON F.role_id = C.id
		INNER JOIN sys_user G ON G.id = F.user_id
        WHERE
            G.id = #{userId}
        ) D ON A.id = D.permission_id
    </select>
</mapper>
